<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Edit Workspace</title>
	<style>
		body {
			background-color: var(--vscode-editor-background);
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.container {
			width: 100vw;
			height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.row {
			width: 100%;
			display: flex;
			justify-content: center;
		}

		.card {
			margin-top: 40px;
			background: var(--vscode-sideBar-background) !important;
			color: var(--vscode-editor-foreground);
			min-width: 600px;
		}

		label,
		input,
		h5,
		h6,
		th,
		td {
			color: var(--vscode-editor-foreground) !important;
		}

		.input-field input {
			background: var(--vscode-input-background);
			color: var(--vscode-input-foreground);
			border-bottom: 1px solid var(--vscode-input-border);
		}

		.btn {
			background: var(--vscode-button-background);
			color: var(--vscode-button-foreground);
		}

		.btn:hover {
			background: var(--vscode-button-hoverBackground);
		}

		table.striped>tbody>tr>td {
			color: var(--vscode-editor-foreground);
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="row">
			<div class="col">
				<div class="card">
					<div class="card-content">
						<span class="card-title">Edit Workspace</span>
						<div class="input-field">
							<input id="workspaceName" type="text" value="" autofocus />
							<label for="workspaceName">Workspace Name</label>
						</div>
						<h6>Project Paths</h6>
						<table id="projectPathsTable" class="striped">
							<thead>
								<tr>
									<th>Path</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="projectPathsBody">
								<!-- Project paths will be inserted here -->
							</tbody>
						</table>
						<div class="section">
							<a class="btn waves-effect" id="addPathBtn">Add Project</a>
						</div>
					</div>
					<div class="card-action">
						<a class="btn" id="saveBtn">Save</a>
						<a class="btn grey lighten-1 black-text" id="cancelBtn">Cancel</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			M.updateTextFields();
		});
		const vscode = acquireVsCodeApi();
		let projectPaths = [];
		if (window.initialProjectPaths && Array.isArray(window.initialProjectPaths)) {
			projectPaths = window.initialProjectPaths;
		}
		function renderProjectPaths() {
			const tbody = document.getElementById('projectPathsBody');
			tbody.innerHTML = '';
			projectPaths.forEach((path, idx) => {
				const tr = document.createElement('tr');
				const tdPath = document.createElement('td');
				tdPath.textContent = path;
				const tdActions = document.createElement('td');
				const removeBtn = document.createElement('a');
				removeBtn.className = 'btn red lighten-1';
				removeBtn.textContent = 'Remove';
				removeBtn.onclick = () => {
					projectPaths.splice(idx, 1);
					renderProjectPaths();
				};
				tdActions.appendChild(removeBtn);
				tr.appendChild(tdPath);
				tr.appendChild(tdActions);
				tbody.appendChild(tr);
			});
		}
		document.getElementById('addPathBtn').onclick = () => {
			vscode.postMessage({ command: 'chooseFolder' });
		};
		window.addEventListener('message', event => {
			const message = event.data;
			if (message.command === 'addPath' && message.path) {
				projectPaths.push(message.path);
				renderProjectPaths();
			}
		});
		document.getElementById('saveBtn').onclick = () => {
			const newName = document.getElementById('workspaceName').value;
			vscode.postMessage({ command: 'save', newName, projectPaths });
		};
		document.getElementById('cancelBtn').onclick = () => {
			vscode.postMessage({ command: 'cancel' });
		};
		renderProjectPaths();
	</script>
</body>

</html>